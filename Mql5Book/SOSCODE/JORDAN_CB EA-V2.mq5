#property copyright "Source Code Technlogies"
#property link      "https://www.soscode.com"
#property version   "1.10"

#include <Trade\XTrade.mqh>
//#include <Mql5Book\XTrade.mqh>
CTrade TradeX;
// Timer
#include <Mql5Book\Timer.mqh>
CTimer Timer;
CNewBar NewBar;

// Price
#include <Mql5Book\Price.mqh>
CBars Price;

input bool PlaceTrades = true;
input int MyMagicNumber = 0;

sinput string strategy_1;
input bool ActivateSys1 = false;
input int MAPeriodShort=2;
input int MAPeriodLong=200;
input int FourMAPeriod=200;

sinput string __strategy_2__;	
input bool ActivateSys2 = true;
input int NonLagMAPeriod=200;
input bool confirmByNonlag = true;

sinput string params;
input int MAShift=0;
input ENUM_MA_METHOD MAMethodS= MODE_EMA;
input ENUM_MA_METHOD MAMethodL= MODE_EMA;
input ENUM_APPLIED_PRICE MAPrice= PRICE_CLOSE;

sinput string MoneyManagement;		
input double volume=0.2;

sinput string CashMeasures;
input bool UseTakeProfitCash=true;
input double takeProfitCash=5.0;
input double takeProfitCashLongs=20.0;
input double DailyProfitCash=100.0;

sinput string PercentageMeasures;
input double takeProfitPercentage=1.0;
input double takeProfitPercentageLongs=30.0;
input double DailyProfitPercentage=50;
input double stopLossPercentage=0.0;
input double PercentagelossToStopDayTrading = 50;
input bool TradeLongsOnce=true;


input bool AllSymbols = false;
input bool TradeOnEveryTick = true;
input int MaximumTradeCount = 6;
input int TradeBasketsPerTrend = 2;
input bool miniExitByNonlag = true;

sinput string TradeTypeOptions;	
input bool FullAutoPilot = true;
input bool SellOnly = false;
input bool BuyOnly = false;
input bool TradeImmediately = false;
input bool TradeImmediatelyWithBuy = false;
input bool TradeImmediatelyWithSell = false;

sinput string ALERTS;		
input bool   alertsOnCurrent = false;
input bool   alertsMessage   = false;
input bool   alertsOnPhone   = false;
input bool   alertsEmail     = false;
input bool   alertsSound     = false;
input bool   alertsTelegram  = false;
input string     APIkey      = "1819898948:AAFRCYc45DMt_hTjwRtUuk58iRIvc1bRcIs";
input string     Channel_ID  = "-590157620";
//-------------------------


enum orderType{
   orderBuy,
   orderSell
};

datetime candleTimes[],lastCandleTime;
string CurSignal="";
string CurSignalNonLag="";
string CurTrend;
string CurTrendNonLag;
int CandleSeq=1;
int MagicNumber=0;
double onStartEquity=0;
bool innerlocked = false;
bool closedFalls = false;
//+---trade closing
int RTOTAL=4;       
int SLEEPTIME=1;     
int  Deviation_=10;
long Slippage = 3;
bool TradeOnEveryTickL = false;
string EA_Version = "#Jordan_CB EA-V2";
double curProfit=0;


MqlTradeRequest request;
MqlTradeResult result;
MqlTradeCheckResult checkResult;

//+------------------------------------------------------------------+ 
//| start function                                                   |
//+------------------------------------------------------------------+
int OnInit(){
	ArraySetAsSeries(candleTimes,true);
	onStartEquity = AccountInfoDouble(ACCOUNT_EQUITY);
	innerlocked = false;
	closedFalls = false;
	if(TradeImmediatelyWithBuy){
	   CurSignal = "BUY";
	   CurSignalNonLag = "BUY";
	   }
	if(TradeImmediatelyWithSell){
	   CurSignal = "SELL";
	   CurSignalNonLag = "SELL";
	   }
	   TradeOnEveryTickL  = TradeOnEveryTick;
	   //Print(">>"+_Symbol+"<<");
	return(0);
}



void OnTick(){
Comment("Copyright Â© 2021 Soscode Tech,\nStart Bal. "+onStartEquity+" , Current Bal. "+AccountInfoDouble(ACCOUNT_EQUITY) +", Profit. "+curProfit+"\nSYS 1:"+CurTrend+"\nSYS 2:"+CurTrendNonLag+ " <--NonLag [Default]\nInner Locked:"+innerlocked);

// rechecking if magic number is set
// rechecking if magic number is set
   if(MagicNumber <= 0 && MyMagicNumber <= 0)
     {
      MagicNumber = MathAbs(ChartID());
      if(MagicNumber <= 0){
         MagicNumber = MagicNumber * -1;
      }
      printf("MagicNumber AutoSet To => "+ MagicNumber);
     }else if(MyMagicNumber > 0){
      MagicNumber = MyMagicNumber;
     }
  
	
	if(checkNewCandle(candleTimes,lastCandleTime)){
		double maS[];
		double maL[];
		double maSNonLag[];
		double maLNonLag[];
		double NonLagSignalValues[];
		ArraySetAsSeries(maS,true);
		ArraySetAsSeries(maL,true);
		ArraySetAsSeries(maSNonLag,true);
		ArraySetAsSeries(maLNonLag,true);
		ArraySetAsSeries(NonLagSignalValues,true);
		double candleClose[];
		ArraySetAsSeries(candleClose,true);
		int maSHandle= iMA(_Symbol,_Period,MAPeriodShort,MAShift,MAMethodS,MAPrice);
		int maLHandle= iMA(_Symbol,_Period,MAPeriodLong,MAShift,MAMethodL,MAPrice);
		//+FOR NONLAG
		int maLHandleNonLag = iCustom(_Symbol,_Period, "NonLagMaAlerts");
		int maSHandleNonLag= iMA(_Symbol,_Period,10,0,MODE_EMA,MAPrice);
		
		CopyBuffer(maSHandle,0,0,3,maS);
		CopyBuffer(maLHandle,0,0,3,maL);//CopyBuffer(NonlagMaHandle,0,0,3,NonLagSignalValues);
		CopyBuffer(maLHandleNonLag,0,0,3,maLNonLag);//Non Lag Ma
		//CopyBuffer(maLHandleNonLag,2,0,3,maLNonLag);//Non Lag Ma Actual Trend
		CopyBuffer(maSHandleNonLag,0,0,3,maSNonLag);//EMa 10
		
		
		CopyClose(_Symbol,_Period,0,3,candleClose);
		


		if((maS[CandleSeq+1] < maL[CandleSeq+1])&&(maS[CandleSeq]>maL[CandleSeq])){
			//cross up
			Print("Cross above!");
			//closePosition();
			if(confirmByNonlag && CurSignalNonLag == "BUY"){
   			if(ActivateSys1)TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage ); 
   			//makePosition(orderBuy);
   			CurSignal="BUY";
   			if(ActivateSys1)Price.SendAlert("BUY", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey);
			}else if(!confirmByNonlag){
   			if(ActivateSys1)TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage ); 
   			CurSignal="BUY";
   			if(ActivateSys1)Price.SendAlert("BUY", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey);
			}
			
		}else if((maS[CandleSeq+1]>maL[CandleSeq+1])&&(maS[CandleSeq]<maL[CandleSeq])){
			//cross down
			Print("Cross under!");
			//closePosition();
			if(confirmByNonlag && CurSignalNonLag == "SELL"){
   			if(ActivateSys1)TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
   			//makePosition(orderSell); 
   			CurSignal="SELL";
   			if(ActivateSys1)Price.SendAlert("SELL", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey); 
			} else if(!confirmByNonlag){
   			if(ActivateSys1)TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage ); 
   			CurSignal="SELL";
   			if(ActivateSys1)Price.SendAlert("SELL", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey);
			} 

		}else if(maS[CandleSeq]>maL[CandleSeq]){
			CurTrend="BUYING";
			if(ActivateSys1)CloseAllTrades("SELL");
			if(ActivateSys1 && TradeImmediately)CurSignal="BUY";
		}else if(maS[CandleSeq]<maL[CandleSeq]){
		   CurTrend="SELLING";
		   if(ActivateSys1)CloseAllTrades("BUY");
		   if(ActivateSys1 && TradeImmediately)CurSignal="SELL";
		}
		
		//FOR NON LAG
		
		if((maSNonLag[CandleSeq+1] < maLNonLag[CandleSeq+1])&&(maSNonLag[CandleSeq]>maLNonLag[CandleSeq])){
			//cross up
			Print("Cross above for Non Lag!");
			//closePosition();
			if(ActivateSys2)CloseAllTrades("SELL"); //close all sells
			//makePosition(orderBuy);
			CurSignalNonLag="BUY";
			if(ActivateSys2)Price.SendAlert("BUY", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey);
			

		}else if((maSNonLag[CandleSeq+1]>maLNonLag[CandleSeq+1])&&(maSNonLag[CandleSeq]<maLNonLag[CandleSeq])){
			//cross down
			Print("Cross under for Non Lag!");
			//closePosition();
			if(ActivateSys2)CloseAllTrades("BUY"); //close all buys
			//makePosition(orderSell); 
			CurSignalNonLag="SELL";
			if(ActivateSys2)Price.SendAlert("SELL", "\n "+EA_Version+" ", alertsMessage, alertsOnPhone, alertsEmail, alertsSound, alertsTelegram, Channel_ID, APIkey);  
		 

		}else if((maSNonLag[CandleSeq]>maLNonLag[CandleSeq])){
		   CurTrendNonLag="BUYING";
		   if(ActivateSys2)CloseAllTrades("SELL");
			if(ActivateSys2 && TradeImmediately)CurSignalNonLag="BUY"; 
		}else if((maSNonLag[CandleSeq]<maLNonLag[CandleSeq])){
		   CurTrendNonLag="SELLING";
		   if(ActivateSys2)CloseAllTrades("BUY");
		   if(ActivateSys2 && TradeImmediately)CurSignalNonLag="SELL"; 
		}
		
		//FOR NON LAG ENDS
		
		 
		//Check Daily Target
	   CheckDailyTarget();
	}
	//Check and remove closedFalls if crushes and booms are done
	if(
	   ((_Symbol == "Crash 1000 Index" || _Symbol == "Crash 500 Index") && ((CurTrend == "BUYING" && ActivateSys1)  || (CurTrendNonLag == "BUYING" && ActivateSys2))) ||
	   ((_Symbol == "Boom 1000 Index" || _Symbol == "Boom 500 Index") && ((CurTrend == "SELLING" && ActivateSys1) || (CurTrendNonLag == "SELLING" && ActivateSys2)))
	)
	{
	   closedFalls = false;
	   TradeOnEveryTickL = TradeOnEveryTick;
	}
	
	//Prepare for trading
	
	if(NewBar.CheckNewBar(_Symbol,_Period) && MaximumTradeCount > PositionsTotal() && PlaceTrades && !innerlocked){
	    if((CurSignal=="BUY" && ActivateSys1) || (CurSignalNonLag =="BUY" && ActivateSys2)){
	      if(FullAutoPilot)
		      makePosition(orderBuy);
		     else if(BuyOnly) 
		      makePosition(orderBuy);
		 }
		 if((CurSignal=="SELL" && ActivateSys1)  || (CurSignalNonLag =="SELL" && ActivateSys2)){
   		 if(FullAutoPilot)
   		   makePosition(orderSell);
   		    else if(SellOnly) 
   		      makePosition(orderSell);
		 }
	}
	else if(TradeOnEveryTickL && MaximumTradeCount > PositionsTotal() && PlaceTrades && !innerlocked){
   	    if((CurSignal=="BUY" && ActivateSys1) || (CurSignalNonLag =="BUY" && ActivateSys2)){
   	      if(FullAutoPilot)
   		      makePosition(orderBuy);
   		   else if(BuyOnly) 
   		      makePosition(orderBuy);
   		 }
   		  if((CurSignal=="SELL" && ActivateSys1)  || (CurSignalNonLag =="SELL" && ActivateSys2)){
      		 if(FullAutoPilot)
      		   makePosition(orderSell);
      		 else if(SellOnly) 
      		   makePosition(orderSell);
   		 }
	}
	
	//close by profits
	CloseMiniProfits();
   	
	//close by lose
  if(TotalProfit() < -((PercentagelossToStopDayTrading/100) * onStartEquity)){
	   if(!AllSymbols){
         TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
         //PlaceTrades= false;
         //send notification
         //Stop auto trading
         
       }
       else{
           TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );      
       }
       innerlocked = true;
	}
	
}

void CloseMiniProfits(){
//Taking Profits
	if(
	   ((_Symbol == "Crash 1000 Index" || _Symbol == "Crash 500 Index") && ((CurTrend == "SELLING" && ActivateSys1) || (CurTrendNonLag == "SELLING" && ActivateSys2))) ||
	   ((_Symbol == "Boom 1000 Index" || _Symbol == "Boom 500 Index") && ((CurTrend == "BUYING" && ActivateSys1) || (CurTrendNonLag == "BUYING" && ActivateSys2)))
	){ 
	   //TradeOnEveryTickL = false;
	   if(UseTakeProfitCash){
   	   if(TotalProfit() >= takeProfitCashLongs ){
    
         	   if(!AllSymbols){    	
                  TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
                }
                else{
                    TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );      
                }
                if(TradeLongsOnce)closedFalls = true;
         	}
	   
	   }else{
      	if(TotalProfit() >= ((takeProfitPercentageLongs/100) * onStartEquity)){
    
         	   if(!AllSymbols){    	
                  TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
                }
                else{
                    TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );      
                }
                if(TradeLongsOnce)closedFalls = true;
         	}
     }
	}else{
	   TradeOnEveryTickL = TradeOnEveryTick;
	   if(UseTakeProfitCash){
   	   if(TotalProfit() >=takeProfitCash){
         	   
         	   if(!AllSymbols){
                  TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
                }
                else{
                    TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );      
                }
         	}
         }else{
         	   if(TotalProfit() >= ((takeProfitPercentage/100) * onStartEquity)){
            	   
            	   if(!AllSymbols){
                     TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );
                   }
                   else{
                       TradeX.PositionCloseCustom(_Symbol,MagicNumber ,Slippage );      
                   }
            	}
         }
      	
	}
	//Calculate Profits
	curProfit = NormalizeDouble((AccountInfoDouble(ACCOUNT_EQUITY) - onStartEquity),_Digits); 
}

bool CheckDailyTarget(){
   double curTodayprofit = AccountInfoDouble(ACCOUNT_EQUITY) - onStartEquity;
   double expTodayprofit = (DailyProfitPercentage/100)*onStartEquity;

   if((curTodayprofit >= expTodayprofit && !UseTakeProfitCash) || (curTodayprofit >= DailyProfitCash && UseTakeProfitCash))//target reached
   {
      innerlocked = true;
      return true;  
   }
   else{
      return false;
   }
}

bool makePosition(orderType type){

   //logic to buy or sell once in Crushing or booming market
   if((
	   ((_Symbol == "Crash 1000 Index" || _Symbol == "Crash 500 Index") && ((CurTrend == "SELLING" && ActivateSys1) || (CurTrendNonLag == "SELLING" && ActivateSys2))) ||
	   ((_Symbol == "Boom 1000 Index" || _Symbol == "Boom 500 Index") && ((CurTrend == "BUYING" && ActivateSys1) || (CurTrendNonLag == "BUYING" && ActivateSys2)))
	   ) && closedFalls
	){
	   return false;
	}
   //--ends here
	ZeroMemory(request);
	request.symbol=_Symbol;
	request.volume=volume;
	request.action=TRADE_ACTION_DEAL;
	request.type_filling=ORDER_FILLING_FOK;
	request.magic = MagicNumber;
	double price=0;
	//setting stop losses
	if(
	   ((_Symbol == "Crash 1000 Index" || _Symbol == "Crash 500 Index") && ((CurTrend == "BUYING" && ActivateSys1)  || (CurTrendNonLag == "BUYING" && ActivateSys2))) ||
	   ((_Symbol == "Boom 1000 Index" || _Symbol == "Boom 500 Index") && ((CurTrend == "SELLING" && ActivateSys1) || (CurTrendNonLag == "SELLING" && ActivateSys2)))
	)
	{
	   // Update prices
	   Price.Update(_Symbol,_Period);
	   request.sl=NormalizeDouble(Price.Open(1),_Digits);
	}

	if(type==orderBuy){
		//Buy
		request.type=ORDER_TYPE_BUY;
		price=NormalizeDouble(SymbolInfoDouble(_Symbol,SYMBOL_ASK),_Digits);
		//request.sl=NormalizeDouble(price-stopLoss,_Digits);
		//request.tp=NormalizeDouble(price+takeProfit,_Digits);
		
	}else if(type==orderSell){
		//Sell
		request.type=ORDER_TYPE_SELL;
		price=NormalizeDouble(SymbolInfoDouble(_Symbol,SYMBOL_BID),_Digits);
		//request.sl=NormalizeDouble(price+stopLoss,_Digits);
		//request.tp=NormalizeDouble(price-takeProfit,_Digits);

	}
	request.deviation=10;
	request.price=price;


	if(OrderCheck(request,checkResult)){
		Print("Checked!");
	}else{
		Print("Not Checked! ERROR :"+IntegerToString(checkResult.retcode));
		return false;
	}

	if(OrderSend(request,result)){
		Print("Ordem enviada com sucesso!");
	}else{
		Print("Ordem nÃ£o enviada!");
		return false;
	}

	if(result.retcode==TRADE_RETCODE_DONE || result.retcode==TRADE_RETCODE_PLACED){
		Print("Trade Placed!");
		return true;
	}else{
		return false;
	}
}

bool checkNewCandle(datetime &candles[],datetime &last){
	bool newCandle=false;

	CopyTime(_Symbol,_Period,0,3,candles);

	if(last!=0){
		if(candles[0]>last){
			newCandle=true;
			last=candles[0];
		}
	}else{
		last=candles[0];
	}

	return newCandle;
}

bool checkNewCandle2(datetime &candles[],datetime &last){
	bool newCandle=false;

	CopyTime(_Symbol,_Period,0,3,candles);

	if(last!=0){
		if(candles[0]>last){
			newCandle=true;
			last=candles[0];
		}
	}else{
		last=candles[0];
	}

	return newCandle;
}

bool closePosition(){
	TradeX.PositionClose(_Symbol ,Slippage );
	return true;
}

void CloseAllTrades()
  {
//----   
   for(uint count=0; count<=RTOTAL && !IsStopped(); count++)
     {
      //---- Ð·Ð°ÐºÑÑÐ²Ð°ÐµÐ¼ Ð²ÑÐµ Ð¾ÑÐºÑÑÑÑÐµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð¿Ð¾ ÑÐµÐºÑÑÐµÐ¼Ñ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ
      int total=PositionsTotal();
      if(!total) return; // Ð²ÑÐµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð·Ð°ÐºÑÑÑÑ
      for(int pos=total-1; pos>=0; pos--)
        {
         ulong ticket=ulong(PositionGetTicket(pos));
         if(!PositionSelectByTicket(ticket)) continue;
          string symbol=PositionGetSymbol(pos);
         if(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE_BUY)
           {
            bool BUY_Close=true;
            BuyPositionClose(BUY_Close,symbol,Deviation_);
           }
         if(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE_SELL)
           {
            bool SELL_Close=true;
            SellPositionClose(SELL_Close,symbol,Deviation_);
           }
        }
      if(!PositionsTotal()) break;
      Sleep(SLEEPTIME*1000);
     }
//----
  }
  
  void CloseAllTrades(string OrderType)
  {
//----   
   for(uint count=0; count<=RTOTAL && !IsStopped(); count++)
     {
      //---- Ð·Ð°ÐºÑÑÐ²Ð°ÐµÐ¼ Ð²ÑÐµ Ð¾ÑÐºÑÑÑÑÐµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð¿Ð¾ ÑÐµÐºÑÑÐµÐ¼Ñ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ
      int total=PositionsTotal();
      if(!total) return; // Ð²ÑÐµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð·Ð°ÐºÑÑÑÑ
      for(int pos=total-1; pos>=0; pos--)
        {
         ulong ticket=ulong(PositionGetTicket(pos));
         if(!PositionSelectByTicket(ticket)) continue;
          string symbol=PositionGetSymbol(pos);
         if(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE_BUY && OrderType == "BUY")
           {
            bool BUY_Close=true;
            BuyPositionClose(BUY_Close,symbol,Deviation_);
           }
         if(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE_SELL && OrderType == "SELL")
           {
            bool SELL_Close=true;
            SellPositionClose(SELL_Close,symbol,Deviation_);
           }
        }
      if(!PositionsTotal()) break;
      Sleep(SLEEPTIME*1000);
     }
//----
  }
//+------------------------------------------------------------------+
//| ÐÐ°ÐºÑÑÐ²Ð°ÐµÐ¼ Ð´Ð»Ð¸Ð½Ð½ÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ                                        |
//+------------------------------------------------------------------+
bool BuyPositionClose
(
bool &Signal,         // ÑÐ»Ð°Ð³ ÑÐ°Ð·ÑÐµÑÐµÐ½Ð¸Ñ Ð½Ð° ÑÐ´ÐµÐ»ÐºÑ
const string symbol,  // ÑÐ¾ÑÐ³Ð¾Ð²Ð°Ñ Ð¿Ð°ÑÐ° ÑÐ´ÐµÐ»ÐºÐ¸
uint deviation        // ÑÐ»Ð¸Ð¿Ð¿Ð°Ð¶
)
  {
//----
   if(!Signal) return(true);

//---- ÐÐ±ÑÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° Ð¸ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ° ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ°
   MqlTradeRequest request;
   MqlTradeResult result;
//---- ÐÐ±ÑÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑÑ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ° Ð¿ÑÐ¾Ð²ÐµÑÐºÐ¸ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° 
   MqlTradeCheckResult check;

//---- Ð¾Ð±Ð½ÑÐ»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑ
   ZeroMemory(request);
   ZeroMemory(result);
   ZeroMemory(check);

//---- ÐÑÐ¾Ð²ÐµÑÐºÐ° Ð½Ð° Ð½Ð°Ð»Ð¸ÑÐ¸Ðµ Ð¾ÑÐºÑÑÑÐ¾Ð¹ BUY Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸
   if(PositionSelect(symbol))
     {
      if(PositionGetInteger(POSITION_TYPE)!=POSITION_TYPE_BUY) return(false);
     }
   else return(false);

   double MaxLot,volume,Bid;
//---- Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÐ°ÑÑÑÑÐ°    
   if(!PositionGetDouble(POSITION_VOLUME,volume)) return(true);
   if(!SymbolInfoDouble(symbol,SYMBOL_VOLUME_MAX,MaxLot)) return(true);
   if(!SymbolInfoDouble(symbol,SYMBOL_BID,Bid)) return(true);

//---- Ð¿ÑÐ¾Ð²ÐµÑÐºÐ° Ð»Ð¾ÑÐ° Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑÐ½Ð¾Ðµ Ð´Ð¾Ð¿ÑÑÑÐ¸Ð¼Ð¾Ðµ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ       
   if(volume>MaxLot) volume=MaxLot;

//---- ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ ÑÑÑÑÐºÑÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° MqlTradeRequest Ð´Ð»Ñ Ð·Ð°ÐºÑÑÐ²Ð°Ð½Ð¸Ñ BUY Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸
   request.type   = ORDER_TYPE_SELL;
   request.price  = Bid;
   request.action = TRADE_ACTION_DEAL;
   request.symbol = symbol;
   request.volume = volume;
   request.sl = 0.0;
   request.tp = 0.0;
   request.deviation=deviation;
// request.type_filling=ORDER_FILLING_FOK;
   request.position=PositionGetInteger(POSITION_TICKET); 

//---- ÐÑÐ¾Ð²ÐµÑÐºÐ° ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° Ð½Ð° ÐºÐ¾ÑÑÐµÐºÑÐ½Ð¾ÑÑÑ
   if(!OrderCheck(request,check))
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²ÐµÑÐ½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ Ð´Ð»Ñ ÑÑÑÑÐºÑÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ°!");
      Print(__FUNCTION__,"(): OrderCheck(): ",ResultRetcodeDescription(check.retcode));
      return(false);
     }
//----     
   string comment="";
   StringConcatenate(comment,"<<< ============ ",__FUNCTION__,"(): ÐÐ°ÐºÑÑÐ²Ð°ÐµÐ¼ Buy Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ Ð¿Ð¾ ",symbol," ============ >>>");
   Print(comment);

//---- ÐÑÐ¿ÑÐ°Ð²ÐºÐ° Ð¿ÑÐ¸ÐºÐ°Ð·Ð° Ð½Ð° Ð·Ð°ÐºÑÑÐ²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð½Ð° ÑÐ¾ÑÐ³Ð¾Ð²ÑÐ¹ ÑÐµÑÐ²ÐµÑ
   if(!OrderSend(request,result) || result.retcode!=TRADE_RETCODE_DONE)
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°ÐºÑÑÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ!");
      Print(__FUNCTION__,"(): OrderSend(): ",ResultRetcodeDescription(result.retcode));
      return(false);
     }
   else
   if(result.retcode==TRADE_RETCODE_DONE)
     {
      Signal=false;
      comment="";
      StringConcatenate(comment,"<<< ============ ",__FUNCTION__,"(): Buy Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ Ð¿Ð¾ ",symbol," Ð·Ð°ÐºÑÑÑÐ° ============ >>>");
      Print(comment);
      PlaySound("ok.wav");
     }
   else
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°ÐºÑÑÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ!");
      Print(__FUNCTION__,"(): OrderSend(): ",ResultRetcodeDescription(result.retcode));
      return(false);
     }
//----
   return(true);
  }
//+------------------------------------------------------------------+
//| ÐÐ°ÐºÑÑÐ²Ð°ÐµÐ¼ ÐºÐ¾ÑÐ¾ÑÐºÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ                                       |
//+------------------------------------------------------------------+
bool SellPositionClose
(
bool &Signal,         // ÑÐ»Ð°Ð³ ÑÐ°Ð·ÑÐµÑÐµÐ½Ð¸Ñ Ð½Ð° ÑÐ´ÐµÐ»ÐºÑ
const string symbol,  // ÑÐ¾ÑÐ³Ð¾Ð²Ð°Ñ Ð¿Ð°ÑÐ° ÑÐ´ÐµÐ»ÐºÐ¸
uint deviation        // ÑÐ»Ð¸Ð¿Ð¿Ð°Ð¶
)
  {
//----
   if(!Signal) return(true);

//---- ÐÐ±ÑÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° Ð¸ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ° ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ°
   MqlTradeRequest request;
   MqlTradeResult result;
//---- ÐÐ±ÑÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑÑ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ° Ð¿ÑÐ¾Ð²ÐµÑÐºÐ¸ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° 
   MqlTradeCheckResult check;

//---- Ð¾Ð±Ð½ÑÐ»ÐµÐ½Ð¸Ðµ ÑÑÑÑÐºÑÑÑ
   ZeroMemory(request);
   ZeroMemory(result);
   ZeroMemory(check);

//---- ÐÑÐ¾Ð²ÐµÑÐºÐ° Ð½Ð° Ð½Ð°Ð»Ð¸ÑÐ¸Ðµ Ð¾ÑÐºÑÑÑÐ¾Ð¹ SELL Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸
   if(PositionSelect(symbol))
     {
      if(PositionGetInteger(POSITION_TYPE)!=POSITION_TYPE_SELL)return(false);
     }
   else return(false);

   double MaxLot,volume,Ask;
//---- Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÐ°ÑÑÑÑÐ°    
   if(!PositionGetDouble(POSITION_VOLUME,volume)) return(true);
   if(!SymbolInfoDouble(symbol,SYMBOL_VOLUME_MAX,MaxLot)) return(true);
   if(!SymbolInfoDouble(symbol,SYMBOL_ASK,Ask)) return(true);

//---- Ð¿ÑÐ¾Ð²ÐµÑÐºÐ° Ð»Ð¾ÑÐ° Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑÐ½Ð¾Ðµ Ð´Ð¾Ð¿ÑÑÑÐ¸Ð¼Ð¾Ðµ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ       
   if(volume>MaxLot) volume=MaxLot;

//---- ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ ÑÑÑÑÐºÑÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° MqlTradeRequest Ð´Ð»Ñ Ð·Ð°ÐºÑÑÐ²Ð°Ð½Ð¸Ñ SELL Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸
   request.type   = ORDER_TYPE_BUY;
   request.price  = Ask;
   request.action = TRADE_ACTION_DEAL;
   request.symbol = symbol;
   request.volume = volume;
   request.sl = 0.0;
   request.tp = 0.0;
   request.deviation=deviation;
// request.type_filling=ORDER_FILLING_FOK;
   request.position=PositionGetInteger(POSITION_TICKET); 

//---- ÐÑÐ¾Ð²ÐµÑÐºÐ° ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ° Ð½Ð° ÐºÐ¾ÑÑÐµÐºÑÐ½Ð¾ÑÑÑ
   if(!OrderCheck(request,check))
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²ÐµÑÐ½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ Ð´Ð»Ñ ÑÑÑÑÐºÑÑÑÑ ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑÐ¾ÑÐ°!");
      Print(__FUNCTION__,"(): OrderCheck(): ",ResultRetcodeDescription(check.retcode));
      return(false);
     }
//----    
   string comment="";
   StringConcatenate(comment,"<<< ============ ",__FUNCTION__,"(): ÐÐ°ÐºÑÑÐ²Ð°ÐµÐ¼ Sell Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ Ð¿Ð¾ ",symbol," ============ >>>");
   Print(comment);

//---- ÐÑÐ¿ÑÐ°Ð²ÐºÐ° Ð¿ÑÐ¸ÐºÐ°Ð·Ð° Ð½Ð° Ð·Ð°ÐºÑÑÐ²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¸ Ð½Ð° ÑÐ¾ÑÐ³Ð¾Ð²ÑÐ¹ ÑÐµÑÐ²ÐµÑ
   if(!OrderSend(request,result) || result.retcode!=TRADE_RETCODE_DONE)
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°ÐºÑÑÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ!");
      Print(__FUNCTION__,"(): OrderSend(): ",ResultRetcodeDescription(result.retcode));
      return(false);
     }
   else
   if(result.retcode==TRADE_RETCODE_DONE)
     {
      Signal=false;
      comment="";
      StringConcatenate(comment,"<<< ============ ",__FUNCTION__,"(): Sell Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ Ð¿Ð¾ ",symbol," Ð·Ð°ÐºÑÑÑÐ° ============ >>>");
      Print(comment);
      PlaySound("ok.wav");
     }
   else
     {
      Print(__FUNCTION__,"(): ÐÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°ÐºÑÑÑÑ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ!");
      Print(__FUNCTION__,"(): OrderSend(): ",ResultRetcodeDescription(result.retcode));
      return(false);
     }
//----
   return(true);
  }
  /*
  double ProfitCheck()
{
   double profit=0;
   int total  = OrdersTotal();
      for (int cnt = total-1 ; cnt >=0 ; cnt--)
      {
         OrderSelect(cnt, SELECT_BY_POS, MODE_TRADES);
         if(AllSymbols)
            profit+=OrderProfit();
         else if(OrderSymbol()==Symbol())
            profit+=OrderProfit();
      }
   return(profit);        
}*/

double TotalProfit()
  {
   double pft=0;
   for(int i=PositionsTotal()-1;i>=0;i--)
     {
      ulong ticket=PositionGetTicket(i);
      if(ticket>0)
        {
          if(!AllSymbols){
            if(PositionGetInteger(POSITION_MAGIC)== MagicNumber && PositionGetString(POSITION_SYMBOL)==Symbol())
              {
               pft+=PositionGetDouble(POSITION_PROFIT);
              }
             }
             else{
                  pft+=PositionGetDouble(POSITION_PROFIT);
             }
        }
     }
     
   return(pft);
  }

//+------------------------------------------------------------------+
//| Ð²Ð¾Ð·Ð²ÑÐ°Ñ ÑÑÑÐ¸Ð½Ð³Ð¾Ð²Ð¾Ð³Ð¾ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ° ÑÐ¾ÑÐ³Ð¾Ð²Ð¾Ð¹ Ð¾Ð¿ÐµÑÐ°ÑÐ¸Ð¸ Ð¿Ð¾ ÐµÐ³Ð¾ ÐºÐ¾Ð´Ñ     |
//+------------------------------------------------------------------+
string ResultRetcodeDescription(int retcode)
  {
   string str;
//----
   switch(retcode)
     {
      case TRADE_RETCODE_REQUOTE: str="Ð ÐµÐºÐ²Ð¾ÑÐ°"; break;
      case TRADE_RETCODE_REJECT: str="ÐÐ°Ð¿ÑÐ¾Ñ Ð¾ÑÐ²ÐµÑÐ³Ð½ÑÑ"; break;
      case TRADE_RETCODE_CANCEL: str="ÐÐ°Ð¿ÑÐ¾Ñ Ð¾ÑÐ¼ÐµÐ½ÐµÐ½ ÑÑÐµÐ¹Ð´ÐµÑÐ¾Ð¼"; break;
      case TRADE_RETCODE_PLACED: str="ÐÑÐ´ÐµÑ ÑÐ°Ð·Ð¼ÐµÑÐµÐ½"; break;
      case TRADE_RETCODE_DONE: str="ÐÐ°ÑÐ²ÐºÐ° Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð°"; break;
      case TRADE_RETCODE_DONE_PARTIAL: str="ÐÐ°ÑÐ²ÐºÐ° Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð° ÑÐ°ÑÑÐ¸ÑÐ½Ð¾"; break;
      case TRADE_RETCODE_ERROR: str="ÐÑÐ¸Ð±ÐºÐ° Ð¾Ð±ÑÐ°Ð±Ð¾ÑÐºÐ¸ Ð·Ð°Ð¿ÑÐ¾ÑÐ°"; break;
      case TRADE_RETCODE_TIMEOUT: str="ÐÐ°Ð¿ÑÐ¾Ñ Ð¾ÑÐ¼ÐµÐ½ÐµÐ½ Ð¿Ð¾ Ð¸ÑÑÐµÑÐµÐ½Ð¸Ñ Ð²ÑÐµÐ¼ÐµÐ½Ð¸";break;
      case TRADE_RETCODE_INVALID: str="ÐÐµÐ¿ÑÐ°Ð²Ð¸Ð»ÑÐ½ÑÐ¹ Ð·Ð°Ð¿ÑÐ¾Ñ"; break;
      case TRADE_RETCODE_INVALID_VOLUME: str="ÐÐµÐ¿ÑÐ°Ð²Ð¸Ð»ÑÐ½ÑÐ¹ Ð¾Ð±ÑÐµÐ¼ Ð² Ð·Ð°Ð¿ÑÐ¾ÑÐµ"; break;
      case TRADE_RETCODE_INVALID_PRICE: str="ÐÐµÐ¿ÑÐ°Ð²Ð¸Ð»ÑÐ½Ð°Ñ ÑÐµÐ½Ð° Ð² Ð·Ð°Ð¿ÑÐ¾ÑÐµ"; break;
      case TRADE_RETCODE_INVALID_STOPS: str="ÐÐµÐ¿ÑÐ°Ð²Ð¸Ð»ÑÐ½ÑÐµ ÑÑÐ¾Ð¿Ñ Ð² Ð·Ð°Ð¿ÑÐ¾ÑÐµ"; break;
      case TRADE_RETCODE_TRADE_DISABLED: str="Ð¢Ð¾ÑÐ³Ð¾Ð²Ð»Ñ Ð·Ð°Ð¿ÑÐµÑÐµÐ½Ð°"; break;
      case TRADE_RETCODE_MARKET_CLOSED: str="Ð ÑÐ½Ð¾Ðº Ð·Ð°ÐºÑÑÑ"; break;
      case TRADE_RETCODE_NO_MONEY: str="ÐÐµÑ Ð´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½ÑÑ Ð´ÐµÐ½ÐµÐ¶Ð½ÑÑ ÑÑÐµÐ´ÑÑÐ² Ð´Ð»Ñ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿ÑÐ¾ÑÐ°"; break;
      case TRADE_RETCODE_PRICE_CHANGED: str="Ð¦ÐµÐ½Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¸ÑÑ"; break;
      case TRADE_RETCODE_PRICE_OFF: str="ÐÑÑÑÑÑÑÐ²ÑÑÑ ÐºÐ¾ÑÐ¸ÑÐ¾Ð²ÐºÐ¸ Ð´Ð»Ñ Ð¾Ð±ÑÐ°Ð±Ð¾ÑÐºÐ¸ Ð·Ð°Ð¿ÑÐ¾ÑÐ°"; break;
      case TRADE_RETCODE_INVALID_EXPIRATION: str="ÐÐµÐ²ÐµÑÐ½Ð°Ñ Ð´Ð°ÑÐ° Ð¸ÑÑÐµÑÐµÐ½Ð¸Ñ Ð¾ÑÐ´ÐµÑÐ° Ð² Ð·Ð°Ð¿ÑÐ¾ÑÐµ"; break;
      case TRADE_RETCODE_ORDER_CHANGED: str="Ð¡Ð¾ÑÑÐ¾ÑÐ½Ð¸Ðµ Ð¾ÑÐ´ÐµÑÐ° Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑ"; break;
      case TRADE_RETCODE_TOO_MANY_REQUESTS: str="Ð¡Ð»Ð¸ÑÐºÐ¾Ð¼ ÑÐ°ÑÑÑÐµ Ð·Ð°Ð¿ÑÐ¾ÑÑ"; break;
      case TRADE_RETCODE_NO_CHANGES: str="Ð Ð·Ð°Ð¿ÑÐ¾ÑÐµ Ð½ÐµÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹"; break;
      case TRADE_RETCODE_SERVER_DISABLES_AT: str="ÐÐ²ÑÐ¾ÑÑÐµÐ¹Ð´Ð¸Ð½Ð³ Ð·Ð°Ð¿ÑÐµÑÐµÐ½ ÑÐµÑÐ²ÐµÑÐ¾Ð¼"; break;
      case TRADE_RETCODE_CLIENT_DISABLES_AT: str="ÐÐ²ÑÐ¾ÑÑÐµÐ¹Ð´Ð¸Ð½Ð³ Ð·Ð°Ð¿ÑÐµÑÐµÐ½ ÐºÐ»Ð¸ÐµÐ½ÑÑÐºÐ¸Ð¼ ÑÐµÑÐ¼Ð¸Ð½Ð°Ð»Ð¾Ð¼"; break;
      case TRADE_RETCODE_LOCKED: str="ÐÐ°Ð¿ÑÐ¾Ñ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸ÑÐ¾Ð²Ð°Ð½ Ð´Ð»Ñ Ð¾Ð±ÑÐ°Ð±Ð¾ÑÐºÐ¸"; break;
      case TRADE_RETCODE_FROZEN: str="ÐÑÐ´ÐµÑ Ð¸Ð»Ð¸ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ñ Ð·Ð°Ð¼Ð¾ÑÐ¾Ð¶ÐµÐ½Ñ"; break;
      case TRADE_RETCODE_INVALID_FILL: str="Ð£ÐºÐ°Ð·Ð°Ð½ Ð½ÐµÐ¿Ð¾Ð´Ð´ÐµÑÐ¶Ð¸Ð²Ð°ÐµÐ¼ÑÐ¹ ÑÐ¸Ð¿ Ð¸ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¾ÑÐ´ÐµÑÐ° Ð¿Ð¾ Ð¾ÑÑÐ°ÑÐºÑ "; break;
      case TRADE_RETCODE_CONNECTION: str="ÐÐµÑ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ñ ÑÐ¾ÑÐ³Ð¾Ð²ÑÐ¼ ÑÐµÑÐ²ÐµÑÐ¾Ð¼"; break;
      case TRADE_RETCODE_ONLY_REAL: str="ÐÐ¿ÐµÑÐ°ÑÐ¸Ñ ÑÐ°Ð·ÑÐµÑÐµÐ½Ð° ÑÐ¾Ð»ÑÐºÐ¾ Ð´Ð»Ñ ÑÐµÐ°Ð»ÑÐ½ÑÑ ÑÑÐµÑÐ¾Ð²"; break;
      case TRADE_RETCODE_LIMIT_ORDERS: str="ÐÐ¾ÑÑÐ¸Ð³Ð½ÑÑ Ð»Ð¸Ð¼Ð¸Ñ Ð½Ð° ÐºÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð¾ÑÐ»Ð¾Ð¶ÐµÐ½Ð½ÑÑ Ð¾ÑÐ´ÐµÑÐ¾Ð²"; break;
      case TRADE_RETCODE_LIMIT_VOLUME: str="ÐÐ¾ÑÑÐ¸Ð³Ð½ÑÑ Ð»Ð¸Ð¼Ð¸Ñ Ð½Ð° Ð¾Ð±ÑÐµÐ¼ Ð¾ÑÐ´ÐµÑÐ¾Ð² Ð¸ Ð¿Ð¾Ð·Ð¸ÑÐ¸Ð¹ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°"; break;
      case TRADE_RETCODE_INVALID_ORDER: str="ÐÐµÐ²ÐµÑÐ½ÑÐ¹ Ð¸Ð»Ð¸ Ð·Ð°Ð¿ÑÐµÑÑÐ½Ð½ÑÐ¹ ÑÐ¸Ð¿ Ð¾ÑÐ´ÐµÑÐ°"; break;
      case TRADE_RETCODE_POSITION_CLOSED: str="ÐÐ¾Ð·Ð¸ÑÐ¸Ñ Ñ ÑÐºÐ°Ð·Ð°Ð½Ð½ÑÐ¼ POSITION_IDENTIFIER ÑÐ¶Ðµ Ð·Ð°ÐºÑÑÑÐ°"; break;
      default: str="ÐÐµÐ¸Ð·Ð²ÐµÑÑÐ½ÑÐ¹ ÑÐµÐ·ÑÐ»ÑÑÐ°Ñ";
     }
//----
   return(str);
  }
//+------------------------------------------------------------------+

   

